{% extends "base.html" %}
{% block title %}Главная{% endblock %}
{% block inner_scripts %}
<script type='text/javascript'>
google.load('visualization', '1', {packages:['table']});
google.load('visualization', '1', {packages:['corechart']});

google.setOnLoadCallback(drawCharts);
function drawCharts() {
  {
    $.getJSON('/expenses',
              {'dim': 'region'},
              function(sourceData) {
                var table = new google.visualization.Table(document.getElementById('top_regions'));
                table.draw(sumJSON2DataTable(sourceData), {showRowNumber: true, allowHtml: true});
              });
  }
  {
    $.getJSON('/expenses',
              {'dim': 'customer'},
              function(sourceData) {
                var table = new google.visualization.Table(document.getElementById('top_customers'));
                table.draw(sumJSON2DataTable(sourceData), {showRowNumber: true, allowHtml: true});
              });
  }
  {
    $.getJSON('/expenses',
              {'dim': 'supplier'},
              function(sourceData) {
                var table = new google.visualization.Table(document.getElementById('top_suppliers'));
                table.draw(sumJSON2DataTable(sourceData), {showRowNumber: true, allowHtml: true});
              });
  }
  {
    $.getJSON('/expenses',
              {'dim': 'type'},
              function(sourceData) {
                var data = sumJSON2DataTable(sourceData);
                drawTypesPieChart('categories_chart', data);

                var table = new google.visualization.Table(document.getElementById('categories_table'));
                table.draw(data, {showRowNumber: true, allowHtml: true});
              });
  }
  {
    $.getJSON('/time_chart.json',
              function(sourceData) {
                drawTimeChart('months_bar_chart', sumJSON2DataTable(sourceData));
              });
  }
}
</script>
{% endblock %}
{% block content %}
<!--div id="visual_container"></div-->
<div class="table_wrapper">
    <h2>Топ регионов</h2>
    <div class="cb"></div>
    <div id="top_regions"></div>
    <div class="cb"></div>
</div>

<div class="table_wrapper">
    <h2>Топ покупателей</h2>
    <div class="cb"></div>
    <div id="top_customers"></div>
    <div class="cb"></div>
</div>

<div class="table_wrapper">
    <h2>Топ продавцов</h2>
    <div class="cb"></div>
    <div id="top_suppliers"></div>
    <div class="cb"></div>
</div>

<div class="table_wrapper">
  <h2>Закупки по категориям</h2>
    <div class="cb"></div>
  <table>
    <tr>
      <td style="vertical-align: top;">
        <div id="categories_chart"></div>
      </td>
      <td style="vertical-align: top;">
        <div id="categories_table"></div>
      </td>
    </tr>
  </table>
  <div class="cb"></div>
</div>
<div class="table_wrapper">
  <h2>Закупки по дате заключения контракта</h2>
  <div class="cb"></div>
  <div id="months_bar_chart"></div>
  <div class="cb"></div>
</div>
{% endblock %}
