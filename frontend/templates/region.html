<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title> Регион </title>

<link href="css/main.css" rel="stylesheet" type="text/css" />

<script type='text/javascript' src='https://www.google.com/jsapi'></script>
<script type='text/javascript'>

  // ------------ jquery start  --------------- //
  google.load("jquery", "1.6.4");
   
  function get_json(myUrl) {
    return $.ajax({
      url: myUrl,
      dataType: 'json', 
      async:false,
    }).responseText;
  } 
  // ------------ jquery end  --------------- // 
       
  google.load('visualization', '1', {packages:['table']});
  google.load('visualization', '1', {packages:['corechart']});
  google.setOnLoadCallback(drawTable);
  function drawTable() {  
    
    {
      var evalledData = eval("(" + get_json('/top_customers?region={{region_code}}&view=json') + ")");
      var data = new google.visualization.DataTable(evalledData);
      var formatter = new google.visualization.NumberFormat(
          {suffix: ' руб', negativeParens: true, fractionDigits: 0, groupingSymbol: ' '});
      formatter.format(data, 1); // Apply formatter to second column
      
      var table = new google.visualization.Table(document.getElementById('customers_table'));
      table.draw(data, {showRowNumber: true});
      // 
      // 
      // table.draw(data, {allowHtml: true, showRowNumber: true});
    }

    {
      var evalledData = eval("(" + get_json('/top_suppliers?region={{region_code}}&view=json') + ")");
      var data = new google.visualization.DataTable(evalledData);
      var formatter = new google.visualization.NumberFormat(
          {suffix: ' руб', negativeParens: true, fractionDigits: 0, groupingSymbol: ' '});
      formatter.format(data, 1); // Apply formatter to second column
      
      var table = new google.visualization.Table(document.getElementById('suppliers_table'));
      table.draw(data, {showRowNumber: true});
      // 
      // 
      // table.draw(data, {allowHtml: true, showRowNumber: true});
    }

    {
      var evalledData = eval("(" + get_json('/region_bar_chart.json?code={{region_code}}') + ")");
      var data = new google.visualization.DataTable(evalledData);
      var formatter = new google.visualization.NumberFormat(
          {suffix: ' руб', negativeParens: true, fractionDigits: 0, groupingSymbol: ' '});
      formatter.format(data, 1); // Apply formatter to second column

      var chart = new google.visualization.ColumnChart(document.getElementById('months_bar_chart'));
      chart.draw(data, {width: 800, height: 500, title: 'Закупки'
          //hAxis: {title: 'Year', titleTextStyle: {color: 'red'}}
      });
    }
    
    {
      var evalledData = eval("(" + get_json('/region_pie_chart.json?code={{region_code}}') + ")");
      var data = new google.visualization.DataTable(evalledData);
      var formatter = new google.visualization.NumberFormat(
          {suffix: ' руб', negativeParens: true, fractionDigits: 0, groupingSymbol: ' '});
      formatter.format(data, 1); // Apply formatter to second column
      var chart = new google.visualization.PieChart(document.getElementById('categories_chart'));
      chart.draw(data, {width: 400, height: 400,
                        chartArea: {top: 20, height: "80%"},
                        legend: "none",
                        is3D: true});
      var table = new google.visualization.Table(document.getElementById('categories_table'));
      table.draw(data, {showRowNumber: true});
      
    }
  }
  
</script>
</head>
<body>
<div class="main_wrapper">

	
    <!-- logo and navy -->
	<div class="header_wrapper"  style="display:block">
        
        <!-- navy -->
    	<div class="main_navy_wrapper">
        	<ul class="top_navy blue_bg_2">
            	<li class="first"><a href="/">Главная</a></li>
                <!-- <li><a href="#">Top поставщиков</a></li>
                <li><a href="#">Top потребителей</a></li> -->                
 			</ul>
        </div>
        <!-- / navy -->
    	<div class="cb"></div>
    </div>
    <!-- / logo and navy -->
    
    <!-- inner title -->
	<div class="inner_title_wrapper blue_bg_inner" style="margin-top:5px;">
	  <span>Визуализация госзакупок</span>
	</div>
    <!-- / inner title -->
    
    <!-- content -->
    <div class="content_wrapper">
    	<div class="content_wide">                    

             <!-- data -->
        	<div class="data_wrapper">
                
                <h2 class="center_title">{{region_name}}</h2> 
                    
                <div class="table_wrapper">  
                    <h2>Top закупщики региона</h2>      
                    <div class="cb"></div>
                     <div id="customers_table"></div>
                    <div class="cb"></div>    
                </div> 

                <div class="table_wrapper">  
                    <h2>Top продавцы региона</h2>      
                    <div class="cb"></div>
                     <div id="suppliers_table"></div>
                    <div class="cb"></div>    
                </div> 
               
                <div id="months_bar_chart"></div>
                <table>
                  <tr>
                    <td style="vertical-align: top;">
                      <div id="categories_chart"></div>                          
                    </td>
                    <td style="vertical-align: top;">
                      <div id="categories_table"></div>
                    </td>
                  </tr>
                </table>                
                
           	    <div class="cb"></div>
            </div>
            <!-- / data -->
                    
            <div class="cb"></div>
        </div>
        <div class="cb"></div>
    </div>
    <!-- / content -->

    <!-- footer -->
    <div class="footer_wrapper">
    	<div class="copyright_1">2011 Визуализация госзакупок</div>
    	<div class="cb"></div>
    </div>
    <!-- / footer -->
    
	<div class="cb"></div>
</div>
<!-- / general content -->


</body>
</html>